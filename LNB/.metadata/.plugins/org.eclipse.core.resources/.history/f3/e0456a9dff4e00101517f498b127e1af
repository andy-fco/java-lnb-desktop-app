package DLL;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.LinkedList;

import BLL.Articulo;
import BLL.Equipo;
import BLL.Jugador;

public class DLLJugador {

	private static Connection con = Conexion.getInstance().getConnection();

	//CREAR JUGADOR
	private static boolean crearJugador(Jugador jugador) {
	    boolean flag = false;

	    try {
	        PreparedStatement stmt = con.prepareStatement(
	            "INSERT INTO jugadores (nombre, apellido, camiseta, media, posicion, nacionalidad, tiro, dribling, velocidad, pase, defensa, " +
	            "salto, d_of_birth, ciudad, altura, mano_habil, especialidad, jugada) " +
	            "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"
	        );

	        stmt.setString(1, jugador.getNombre());
	        stmt.setString(2, jugador.getApellido());
	        stmt.setInt(3, jugador.getCamiseta());
	        stmt.setInt(4, jugador.getMedia());
	        stmt.setString(5, jugador.getPosicion());
	        stmt.setString(6, jugador.getNacionalidad());
	        stmt.setInt(7, jugador.getTiro());
	        stmt.setInt(8, jugador.getDribling());
	        stmt.setInt(9, jugador.getVelocidad());
	        stmt.setInt(10, jugador.getPase());
	        stmt.setInt(11, jugador.getDefensa());
	        stmt.setInt(12, jugador.getSalto());
	        stmt.setDate(13, Date.valueOf(jugador.getdOfBirth()));
	        stmt.setString(14, jugador.getCiudad());
	        stmt.setFloat(15, jugador.getAltura());
	        stmt.setString(16, jugador.getManoHabil());
	        stmt.setString(17, jugador.getEspecialidad());
	        stmt.setString(18, jugador.getJugada());
	         

	        int filas = stmt.executeUpdate();
	        if (filas > 0) {
	            System.out.println("Jugador cargado correctamente.");
	            flag = true;
	        }

	        stmt.close();
	    } catch (Exception e) {
	        e.printStackTrace();
	    }

	    return flag;
	}

	
	//LISTAR JUGADORES
	public static LinkedList<Jugador> mostrarJugadores() {
	    LinkedList<Jugador> jugadores = new LinkedList<>();

	    try {
	        PreparedStatement stmt = con.prepareStatement("SELECT * FROM jugadores");
	        ResultSet rs = stmt.executeQuery();

	        while (rs.next()) {
	           
	        	String nombre = rs.getString("nombre");
	            String apellido = rs.getString("apellido");
	            int camiseta = rs.getInt("camiseta");
	            int media = rs.getInt("media");
	            String posicion = rs.getString("posicion");
	            String nacionalidad = rs.getString("nacionalidad");
	            int equipo_id = rs.getInt("equipo");
	            int tiro = rs.getInt("tiro");
	            int dribling = rs.getInt("dribling");
	            int velocidad = rs.getInt("velocidad");
	            int pase = rs.getInt("pase");
	            int defensa = rs.getInt("defensa");
	            int salto = rs.getInt("salto");
	            String d_of_birth = rs.getString("d_of_birth");  
	            String ciudad = rs.getString("ciudad");
	            float altura = rs.getFloat("altura");
	            String mano = rs.getString("mano_habil");
	            String especialidad = rs.getString("especialidad");
	            String jugada = rs.getString("jugada");
	            
	            Equipo equipo = DLLEquipo.buscarEquipoPorId(equipo_id);
	            
	            Jugador j = new Jugador(nombre, apellido, camiseta, media, posicion, nacionalidad, equipo, tiro, dribling, velocidad, pase, defensa, salto, 
	            		d_of_birth, ciudad, altura, mano, especialidad, jugada);
	            
	            
	            jugadores.add(j);
	        }

	        rs.close();
	        stmt.close();
	    } catch (Exception e) {
	        e.printStackTrace();
	    }

	    return jugadores;
	}
	
	
	//EDITAR JUGADOR
	public static boolean editarJugador(Jugador jugador, int id) {
	    boolean flag = false;

	    try {
	        PreparedStatement stmt = con.prepareStatement(
	            "UPDATE jugadores SET nombre = ?, apellido = ?, camiseta = ?, media = ?, posicion = ?, nacionalidad = ?, " +
	            "tiro = ?, dribling = ?, velocidad = ?, pase = ?, defensa = ?, salto = ?, " +
	            "d_of_birth = ?, ciudad = ?, altura = ?, mano_habil = ?, especialidad = ?, jugada = ?" +
	            "WHERE id = ?"
	        );

	        stmt.setString(1, jugador.getNombre());
	        stmt.setString(2, jugador.getApellido());
	        stmt.setInt(3, jugador.getCamiseta());
	        stmt.setInt(4, jugador.getMedia());
	        stmt.setString(5, jugador.getPosicion());
	        stmt.setString(6, jugador.getNacionalidad());
	        stmt.setInt(7, jugador.getTiro());
	        stmt.setInt(8, jugador.getDribling());
	        stmt.setInt(9, jugador.getVelocidad());
	        stmt.setInt(10, jugador.getPase());
	        stmt.setInt(11, jugador.getDefensa());
	        stmt.setInt(12, jugador.getSalto());
	        stmt.setDate(13, Date.valueOf(jugador.getdOfBirth()));
	        stmt.setString(14, jugador.getCiudad());
	        stmt.setFloat(15, jugador.getAltura());
	        stmt.setString(16, jugador.getManoHabil());
	        stmt.setString(17, jugador.getEspecialidad());
	        stmt.setString(18, jugador.getJugada());
	        
	        stmt.setInt(19, id);

	        int filas = stmt.executeUpdate();
	        if (filas > 0) {
	            System.out.println("Jugador actualizado correctamente.");
	            flag = true;
	        }

	        stmt.close();
	    } catch (Exception e) {
	        e.printStackTrace();
	    }

	    return flag;
	}

	//ELIMINAR JUGADOR
	public static boolean eliminarJugador(int id) {
	    boolean flag = false;

	    try (
	        PreparedStatement stmt = con.prepareStatement("DELETE FROM jugadores WHERE id = ?")
	    ) {
	        stmt.setInt(1, id);

	        int filas = stmt.executeUpdate();
	        if (filas > 0) {
	            System.out.println("Jugador eliminado correctamente.");
	            flag = true;
	        }
	    } catch (Exception e) {
	        e.printStackTrace();
	    }

	    return flag;
	}

	//BUSCAR ID DE JUGADOR
	public static int buscarID(Jugador jugador) {
	    int id = -1;
	    int idEquipo = -1;

	    try (
	        PreparedStatement stmtEquipo = con.prepareStatement(
	            "SELECT id FROM equipos WHERE nombre = ?")
	    ) {
	        stmtEquipo.setString(1, jugador.getEquipo().getNombre());

	        try (ResultSet rs = stmtEquipo.executeQuery()) {
	            if (rs.next()) {
	                idEquipo = rs.getInt("id");
	            }
	        }
	    } catch (Exception e) {
	        e.printStackTrace();
	    }

	    if (idEquipo != -1) {
	        try (
	            PreparedStatement stmt = con.prepareStatement(
	                "SELECT id FROM jugadores WHERE equipo = ? AND camiseta = ?")
	        ) {
	            stmt.setInt(1, idEquipo);
	            stmt.setInt(2, jugador.getCamiseta());

	            try (ResultSet rs = stmt.executeQuery()) {
	                if (rs.next()) {
	                    id = rs.getInt("id");
	                }
	            }
	        } catch (Exception e) {
	            e.printStackTrace();
	        }
	    }

	    return id;
	}
	
	//ASIGNAR EQUIPO
	

}
