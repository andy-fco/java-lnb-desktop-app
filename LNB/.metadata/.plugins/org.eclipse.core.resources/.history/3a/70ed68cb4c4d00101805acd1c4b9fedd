package GUI;

import java.awt.EventQueue;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Comparator;
import java.util.LinkedList;
import java.util.stream.Collectors;

import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.border.EmptyBorder;
import javax.swing.table.DefaultTableModel;

import BLL.Admin;
import BLL.Aficionado;
import BLL.Usuario;
import DLL.DLLAficionado;
import DLL.DLLUsuario;

import javax.swing.JTabbedPane;
import java.awt.Component;

public class GestionUsers extends JFrame {

	private static final long serialVersionUID = 1L;
	private JPanel contentPane;
	private DefaultTableModel model;
	private Aficionado aficionadoSeleccionado;
	private JTable table;

	/**
	 * Launch the application.
	 */

	public void run(Admin admin) {
		try {
			GestionUsers frame = new GestionUsers(admin);
			frame.setVisible(true);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/**
	 * Create the frame.
	 */
	public GestionUsers(Admin admin) {
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setBounds(100, 100, 900, 510);
        contentPane = new JPanel();
        contentPane.setBorder(new EmptyBorder(10, 10, 10, 10));
        contentPane.setLayout(null);
        setLocationRelativeTo(null);
        setContentPane(contentPane);
        
        JTabbedPane tabbedPane = new JTabbedPane(JTabbedPane.LEFT);
        tabbedPane.setBounds(10, 10, 866, 443);
        contentPane.add(tabbedPane);
        
        JPanel panel = new JPanel();
        tabbedPane.addTab("Aficionados", null, panel, null);
        panel.setLayout(null);
        
        JLabel lblSeleccionado = new JLabel((String) null);
        lblSeleccionado.setBounds(10, 10, 760, 20);
        panel.add(lblSeleccionado);
        
        JButton btnAgregar = new JButton("Agregar");
        btnAgregar.setBounds(0, 237, 150, 40);
     // Acci칩n: Agregar usuario
        btnAgregar.addActionListener(e -> {
            JTextField nombreField = new JTextField();
            JTextField apellidoField = new JTextField();
            JTextField idField = new JTextField();
            JPasswordField passField = new JPasswordField();
            JPasswordField pass2Field = new JPasswordField();
            JTextField emailField = new JTextField();
            JTextField dobField = new JTextField();
            

            Object[] fields = {
                "Nombre:", nombreField,
                "Apellido:", apellidoField,
                "ID:", idField,
                "Contrase침a:", passField,
                "Repetir:", pass2Field,
                "Email:", emailField,
                "Tipo:", dobField
            };

            int option = JOptionPane.showConfirmDialog(null, fields, "Agregar Usuario", JOptionPane.OK_CANCEL_OPTION);

            if (option == JOptionPane.OK_OPTION) {
                

                Aficionado.registro(nombreField.getText(), 
                		apellidoField.getText(), 
                		idField.getText(), 
                		passField.getText(), 
                		pass2Field.getText(), 
                		emailField.getText(), 
                		dobField.getText());
                cargarTablaAficionado();
            }
        });
        panel.add(btnAgregar);
        
        JButton btnEditar = new JButton("Editar");
        btnEditar.setBounds(160, 237, 150, 40);
        btnEditar.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		if (aficionadoSeleccionado != null) {
        			System.out.print(aficionadoSeleccionado);
				}else {
					System.out.print("Seleccione un usuario");
				}
        		
        	}
        });
        panel.add(btnEditar);
        
        JButton btnEliminar = new JButton("Eliminar");
        btnEliminar.setBounds(320, 237, 150, 40);
        panel.add(btnEliminar);
        
        JLabel lblNewLabel = new JLabel("Filtro");
        lblNewLabel.setBounds(518, 237, 49, 14);
        panel.add(lblNewLabel);
        
        JComboBox comboBox = new JComboBox();
        comboBox.setBounds(518, 278, 131, 22);
        panel.add(comboBox);
        
        JButton btnNewButton = new JButton("filtro");
        btnNewButton.setBounds(518, 311, 131, 23);
        panel.add(btnNewButton);
        
        JButton btnNewButton_1 = new JButton("Limpiar");
        btnNewButton_1.setBounds(548, 351, 89, 23);
        panel.add(btnNewButton_1);
        
        table = new JTable();
        model = new DefaultTableModel(
        	new Object[][] {},
        	new String[] {
        		"ID", "Nombre", "Apellido", "Mail", "Contrase침a", "Fecha de Nacimiento"
        	}
        ) {
        	Class[] columnTypes = new Class[] {
        		String.class, String.class, String.class, String.class, String.class, String.class
        	};

        	public Class<?> getColumnClass(int columnIndex) {
        		return columnTypes[columnIndex];
        	}
        };
        table.setModel(model);

        
        JScrollPane scrollPane = new JScrollPane(table);
        scrollPane.setBounds(0, 28, 745, 199);

        
        panel.add(scrollPane);
        
        JPanel panel_1 = new JPanel();
        tabbedPane.addTab("Administradores", null, panel_1, null);
        
        JButton btnVolver = new JButton("Volver");
        btnVolver.setBounds(10, 442, 85, 21);
        btnVolver.addActionListener(e -> {
        	new AdminMenu(admin).run(admin);
			dispose();
        });
        contentPane.add(btnVolver);

		
        
        // Acci칩n al seleccionar fila
        table.getSelectionModel().addListSelectionListener(e -> {
            if (!e.getValueIsAdjusting()) {
                int row = table.getSelectedRow();
                if (row != -1) {
                    aficionadoSeleccionado = new Aficionado(
                    	(String) model.getValueAt(row, 1),
                        (String) model.getValueAt(row, 2),
                        (String) model.getValueAt(row, 0),
                        (String) model.getValueAt(row, 4),
                        (String) model.getValueAt(row, 3),
                        (String) model.getValueAt(row, 5)

                    );
                    lblSeleccionado.setText("Seleccionado: ID=" + aficionadoSeleccionado.getId()
                            + ", Nombre= " + aficionadoSeleccionado.getNombre()+" "+aficionadoSeleccionado.getApellido()
                            + ", Email= " + aficionadoSeleccionado.getEmail()
                            + ", Fecha de Nacimiento= " + aficionadoSeleccionado.getdOfBirth());
                }
            }
        });

        // Cargar datos
        cargarTablaAficionado();
    }

	private void cargarTablaAficionado() {

		LinkedList<Aficionado> listados = DLLAficionado.mostrarAficionados().stream()
				.sorted(Comparator.comparing(Aficionado::getNombre, String.CASE_INSENSITIVE_ORDER))
				.collect(Collectors.toCollection(LinkedList::new));

		model.setRowCount(0);
		for (Aficionado u : listados) {
			model.addRow(new Object[] { u.getId(), u.getNombre(), u.getApellido(), u.getEmail(), u.getPass(),
					u.getdOfBirth() });
		}
	}
}
