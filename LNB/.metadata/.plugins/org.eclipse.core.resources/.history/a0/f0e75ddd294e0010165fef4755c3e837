package DLL;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import java.util.LinkedList;

import BLL.Admin;
import BLL.Aficionado;

public class DLLAdmin {

	private static Connection con = Conexion.getInstance().getConnection();
	
	
	//LOGIN
	public static Admin login(String id, String pass) {
		Admin admin = new Admin();
		try {
			PreparedStatement stmt = con
					.prepareStatement("SELECT * FROM administradores WHERE id_usuario = ? AND pass = ?");
			stmt.setString(1, id);
			stmt.setString(2, admin.encriptar(pass));

			ResultSet rs = stmt.executeQuery();

			if (rs.next()) {
				String nombre = rs.getString("nombre");
				String apellido = rs.getString("apellido");
				

				admin = new Admin(nombre, apellido, id, pass);
			}
		} catch (Exception e) {
			System.out.print("Error");
		}

		return admin;
	}
	
	//LISTAR USUARIOS
	//Aficionados
	public static LinkedList<Aficionado> mostrarAficionados() {
		LinkedList<Aficionado> aficionados = new LinkedList<>();
		try {
			PreparedStatement stmt = con.prepareStatement("SELECT * FROM aficionados");
			ResultSet rs = stmt.executeQuery();

			while (rs.next()) {

				String nombre = rs.getString("nombre");
				String apellido = rs.getString("email");
				String id = rs.getString("id_usuario");
				String pass = rs.getString("pass");
				String email = rs.getString("email");
				String dOfBirth = rs.getString("d_of_birth");

				aficionados.add(new Aficionado(nombre, apellido, id, pass, email, dOfBirth));

			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return aficionados;
	}
	
	
	//Administradores
	public static LinkedList<Admin> mostrarAdmins(){
		LinkedList<Admin> admins = new LinkedList<>();
		try {
			PreparedStatement stmt = con.prepareStatement("SELECT * FROM administradores");
			ResultSet rs = stmt.executeQuery();

			while (rs.next()) {

				String nombre = rs.getString("nombre");
				String apellido = rs.getString("apellido");
				String id = rs.getString("id_usuario");
				String pass = rs.getString("pass");
				

				admins.add(new Admin(nombre, apellido, id, pass));

			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return admins;
	}
	
	
	
	
	
	//AGREGAR AFICIONADO
	public static boolean agregarAficionado(Aficionado aficionado) {
		
		boolean flag = false;
		try {
            PreparedStatement stmt = con.prepareStatement(
                "INSERT INTO aficionados ( nombre, apellido, id_usuario, pass, email, d_of_birth) VALUES (?,?,?,?,?,?)"
            );
            stmt.setString(1, aficionado.getNombre());
            stmt.setString(2, aficionado.getApellido());
            stmt.setString(3, aficionado.getId());
            stmt.setString(4, aficionado.encriptar(aficionado.getPass()));
            stmt.setString(5, aficionado.getEmail());
            stmt.setDate(6, Date.valueOf(aficionado.getdOfBirth()));
             
           
            
            

            int filas = stmt.executeUpdate();
            if (filas > 0) {
                System.out.println("Usuario agregado correctamente.");
                flag = true;
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
		return flag;
    }
	
	//AGREGAR ADMIN
	public static boolean agregarAdmin(Admin admin){
		boolean flag = false;
		try {
			PreparedStatement stmt = con.prepareStatement(
					"INSERT INTO administradores ( nombre, apellido, id_usuario, pass) VALUES (?,?,?,?)");
			stmt.setString(1, admin.getNombre());
			stmt.setString(2, admin.getApellido());
			stmt.setString(3, admin.getId());
			stmt.setString(4, admin.encriptar(admin.getPass()));

			int filas = stmt.executeUpdate();
			if (filas > 0) {
				System.out.println("Usuario agregado correctamente.");
				flag = true;
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return flag;
	}
	
	
	//EDITAR ADMIN
	public static boolean editarAficionado(Admin admin, String id_viejo) {
		boolean flag = false;
		try {
			PreparedStatement statement = con
					.prepareStatement("UPDATE aficionados SET nombre = ?, apellido = ?, id_usuario = ?, pass = ? WHERE id_usuario = ?");
			statement.setString(1,admin.getNombre());
			statement.setString(2,admin.getApellido());
			statement.setString(3,admin.getId());
			statement.setString(4, admin.encriptar(admin.getPass()));
			
			statement.setString(5, id_viejo);

			int filas = statement.executeUpdate();
			if (filas > 0) {
				flag = true;
			}
			
		}catch (Exception e) {
			e.printStackTrace();
			


		} 
		return flag;

	}
	
	
}
